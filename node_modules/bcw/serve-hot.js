#!/usr/bin/env node
let basePath = process.cwd();
const ParcelBundler = require('parcel-bundler');

let PORT = 8080
async function start() {
  console.log("BASEPATH: ", basePath)
  let b = new ParcelBundler(basePath + "/*.html", {
    hmr: true,
    watch: true,
    cache: false,
    outDir: "dev"
  })
  setPort()
  try {
    await b.serve(PORT)
    console.log(`
Starting up server, serving ${basePath}
  Available on:
  http://localhost:${PORT}
    `)
  } catch (e) {
    console.error(e)
  }
}


function setPort() {
  try {
    if (process.argv) {
      process.argv.find((a, i) => {
        if (a.includes("-p")) {
          PORT = Number(process.argv[i + 1]);
          return true;
        }
      });
    }
  } catch (error) {
    console.error(error);
  }
}

start()